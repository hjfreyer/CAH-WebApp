<link rel="import" href="packages/polymer/polymer.html">
<link rel="import" href="packages/core_elements/core_ajax_dart.html">

<polymer-element name="cah-lobby" attributes="gameId owner">
  <template>
    <template if="{{playerId == null}}">
      <form on-submit="{{joinGame}}">
        <label>Name</label>
        <input value="{{name}}" required>
        <button>Join</button>
      </form>
      <core-ajax-dart
        id="joinRpc"
        url="/cahwebapp"
        handleAs="json"
        on-core-response="{{joined}}"></core-ajax-dart>
    </template>
    <template if="{{playerId}}">
      <input readonly="readonly" onClick="this.select()"
        value="http://localhost:9000/#/g/{{gameId}}/join">
    </template>
    <h2>Other Players</h2>
    <ul>
      <template repeat="{{player in configResponse['players']}}">
        <li>Foo</li>
      </template>
    </ul>
    <a href="/#/">Go</a>
    <core-ajax-dart
      auto
      id="configRpc"
      url="/cahwebapp"
      params='{"action": "getconfig", "gameid": "{{gameId}}"}'
      handleAs="json"
      response="{{configResponse}}"></core-ajax-dart>
    <core-ajax-dart
      auto
      id="roundRpc"
      url="/cahwebapp"
      params='{"action": "getround", "gameid": "{{gameId}}"}'
      handleAs="json"
      response="{{roundResponse}}"></core-ajax-dart>
    <core-ajax-dart
      id="startRpc"
      url="/cahwebapp"
      params="{{ {action: 'start', gameid: gameId, playerid: playerId} | stringify }}"
      handleAs="json"></core-ajax-dart>
    <template if="{{playerId != null && owner}}">
      <button on-click="{{start}}">Start Game</button>
    </template>
  </template>
  <script type="application/dart" src="cah_lobby.dart"></script>
</polymer-element>
